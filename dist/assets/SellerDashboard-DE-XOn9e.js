import{u as z,r as n,j as e,L as c}from"./index-C0VzZSJe.js";import{u as B,b as C,d as h,e as L,q as b,c as v,w,f as R,o as E,l as F,g as Y}from"./AuthContext-XHCfx8-r.js";const q={starter:{id:"starter",name:"Starter",uploads:25,maxPrice:199,days:180,priceINR:100},pro:{id:"pro",name:"Pro",uploads:30,maxPrice:249,days:180,priceINR:300},elite:{id:"elite",name:"Elite",uploads:50,maxPrice:249,days:180,priceINR:800}};function S(s){return s<10?`0${s}`:`${s}`}function x(s){if(!s)return"—";try{const i=s instanceof Date?s:new Date(s?.toMillis?s.toMillis():s);return`${S(i.getDate())}-${S(i.getMonth()+1)}-${i.getFullYear()}`}catch{return"—"}}function H(s){if(!s)return 0;const r=(s instanceof Date?s:new Date(s?.toMillis?s.toMillis():s)).getTime()-Date.now();return Math.max(0,Math.ceil(r/(1e3*60*60*24)))}function p({label:s,value:i,hint:r}){return e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"muted",style:{fontSize:12,marginBottom:6},children:s}),e.jsx("div",{style:{fontSize:22,fontWeight:800},children:i}),r?e.jsx("div",{className:"muted",style:{marginTop:8,fontSize:12},children:r}):null]})})}function A({title:s,children:i,right:r}){return e.jsxs("section",{className:"section",children:[e.jsxs("div",{className:"container",style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:16},children:[e.jsx("h2",{style:{fontSize:20,fontWeight:800},children:s}),r??null]}),e.jsx("div",{className:"container",style:{marginTop:16},children:i})]})}function J(){const{user:s}=B(),i=z(),[r,g]=n.useState(!0),[l,D]=n.useState(null),[d,M]=n.useState(0),[j,P]=n.useState([]),t=n.useMemo(()=>l?.planId?q[l.planId]??null:null,[l?.planId]),o=n.useMemo(()=>l?.expiresAt?Date.now()>new Date(l.expiresAt?.toMillis?l.expiresAt.toMillis():l.expiresAt).getTime():!0,[l?.expiresAt]),y=n.useMemo(()=>H(l?.expiresAt),[l?.expiresAt]);n.useEffect(()=>{let a=!0;async function k(){if(!s?.uid){g(!1);return}try{const u=C(h,"sellers",s.uid),f=await L(u),U=f.exists()?f.data():null,I=b(v(h,"photos"),w("ownerId","==",s.uid)),$=await R(I),T=b(v(h,"photos"),w("ownerId","==",s.uid),E("createdAt","desc"),F(10)),W=(await Y(T)).docs.map(N=>({id:N.id,...N.data()}));if(!a)return;D(U),M($.data().count),P(W)}catch(u){console.error("Dashboard load failed:",u)}finally{a&&g(!1)}}return k(),()=>{a=!1}},[s?.uid]);const m=n.useMemo(()=>!t||o?!1:d<(t?.uploads??0),[t,o,d]);return s?r?e.jsx("main",{className:"section",children:e.jsxs("div",{className:"container",children:[e.jsx("div",{className:"skeleton",style:{height:140,marginBottom:16}}),e.jsxs("div",{className:"grid grid--3",children:[e.jsx("div",{className:"skeleton",style:{height:120}}),e.jsx("div",{className:"skeleton",style:{height:120}}),e.jsx("div",{className:"skeleton",style:{height:120}})]})]})}):e.jsxs("main",{children:[e.jsx("section",{className:"section",children:e.jsx("div",{className:"container card",children:e.jsxs("div",{className:"card-body",style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:16,flexWrap:"wrap"},children:[e.jsxs("div",{children:[e.jsx("div",{className:"muted",style:{marginBottom:6},children:"Welcome"}),e.jsx("h1",{className:"page-title",style:{margin:0},children:s.displayName||"Seller"}),e.jsx("div",{className:"muted",style:{marginTop:6,fontSize:14},children:s.email})]}),e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",flexWrap:"wrap"},children:[!t||o?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"badge",style:{background:"#fee2e2",color:"#991b1b"},children:t?"Plan expired":"No active plan"}),e.jsx(c,{to:"/seller/plan",className:"btn btn--brand",children:"Buy a Plan"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"badge",style:{background:"#dcfce7",color:"#166534"},children:[t.name," / ₹",t.priceINR," / ",t.uploads," uploads / Max ₹",t.maxPrice]}),e.jsxs("span",{className:"badge",children:["Expires: ",x(l.expiresAt)]}),e.jsxs("span",{className:"badge",children:[y," days left"]}),e.jsx(c,{to:"/seller/renew",className:"btn btn--subtle",children:"Pay Again"})]}),e.jsx("button",{className:"btn btn--brand",disabled:!m,onClick:()=>i("/seller/upload"),title:m?"Upload a new photo":"Upgrade or renew to upload more",children:"New Upload"})]})]})})}),e.jsx(A,{title:"Your stats",children:e.jsxs("div",{className:"grid grid--3",children:[e.jsx(p,{label:"Total uploads",value:d,hint:t?`Limit: ${t.uploads}`:"Buy a plan to upload"}),e.jsx(p,{label:"Max price per image",value:t?`₹${t.maxPrice}`:"—",hint:t?`${t.name} plan`:"No active plan"}),e.jsx(p,{label:"Plan days remaining",value:t?`${y} days`:"—",hint:t?`Expires ${x(l.expiresAt)}`:"No active plan"})]})}),e.jsx(A,{title:"Recent uploads",right:e.jsx("button",{className:"btn btn--brand",disabled:!m,onClick:()=>i("/seller/upload"),children:"Upload photo"}),children:j.length===0?e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsx("p",{className:"muted",children:"No uploads yet."})})}):e.jsx("div",{className:"grid grid--3",children:j.map(a=>e.jsxs("div",{className:"card",style:{overflow:"hidden"},children:[e.jsx("div",{className:"card-body",style:{padding:0},children:a.watermarkedUrl?e.jsx("img",{src:a.watermarkedUrl,alt:a.title||"photo"}):a.thumbUrl?e.jsx("img",{src:a.thumbUrl,alt:a.title||"photo"}):a.publicUrl?e.jsx("img",{src:a.publicUrl,alt:a.title||"photo"}):e.jsx("div",{className:"skeleton",style:{height:180}})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:8},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:700},children:a.title||"Untitled"}),e.jsx("div",{className:"muted",style:{fontSize:12},children:a.createdAt?.toMillis?x(a.createdAt):"—"})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsxs("div",{style:{fontWeight:800},children:["₹",a.price??"—"]}),e.jsx("div",{className:"muted",style:{fontSize:12},children:a.status||"active"})]})]})})]},a.id))})}),e.jsx("section",{className:"section",children:e.jsx("div",{className:"container card",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h3",{style:{fontSize:18,fontWeight:800,marginBottom:6},children:"How pricing and limits work"}),e.jsxs("ul",{className:"muted",style:{paddingLeft:18,marginTop:6},children:[e.jsxs("li",{children:["Your plan enforces a maximum ",e.jsx("strong",{children:"number of uploads"})," and a maximum ",e.jsx("strong",{children:"price per image"}),"."]}),e.jsxs("li",{children:["Plan validity is ",e.jsx("strong",{children:"180 days"}),". After that, you’ll need to pay again to get access."]}),e.jsx("li",{children:"Watermarks are visible to you and buyers until purchase. After payment, the buyer can download the clean HD image."})]}),e.jsxs("div",{style:{marginTop:14,display:"flex",gap:10},children:[e.jsx(c,{to:"/seller/plan",className:"btn btn--brand",children:"Buy a Plan"}),e.jsx(c,{to:"/seller/renew",className:"btn btn--subtle",children:"Pay Again"}),e.jsx(c,{to:"/contact",className:"btn",children:"Need help?"})]})]})})}),e.jsxs("footer",{className:"footer",children:["© ",new Date().getFullYear()," Picsellart"]})]}):e.jsx("main",{className:"section",children:e.jsx("div",{className:"container card",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h1",{className:"page-title",children:"Seller dashboard"}),e.jsx("p",{className:"page-desc",children:"Please sign in first."}),e.jsx("div",{style:{marginTop:16},children:e.jsx(c,{to:"/seller/login",className:"btn btn--brand",children:"Seller Login"})})]})})})}export{J as default};
