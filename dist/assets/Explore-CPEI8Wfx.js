import{u as H,j as e,r as c}from"./index-BJYG5pbX.js";import{g as K,a as M,b as B,i as Q,c as X,G as O,d as V,q as _,o as F,s as Y,l as G,e as ee,f as $,r as q,h as te}from"./index-68602d24-D5m4K3rK.js";function se({photo:s}){const u=H(),d=()=>{s?.id&&u(`/photo/${encodeURIComponent(s.id)}`,{state:{photo:s}})};return e.jsxs("div",{className:"rounded-xl shadow-sm border border-gray-200 overflow-hidden bg-white hover:shadow-md transition",role:"article","aria-label":s.title||"Photo",children:[e.jsx("div",{className:"aspect-[4/3] w-full bg-gray-100 overflow-hidden",children:s?.url?e.jsx("img",{src:s.url,alt:s.title||"photo",className:"w-full h-full object-cover",loading:"lazy"}):e.jsx("div",{className:"w-full h-full grid place-items-center text-gray-400 text-sm",children:"Loading…"})}),e.jsxs("div",{className:"p-3",children:[e.jsx("div",{className:"text-sm text-gray-800 truncate",children:s.title||"Untitled"}),!!s.tags?.length&&e.jsx("div",{className:"mt-1 flex flex-wrap gap-1",children:s.tags.slice(0,3).map(l=>e.jsx("span",{className:"px-2 py-0.5 text-[11px] rounded-full bg-gray-100 text-gray-600",children:l},l))}),e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsx("button",{type:"button",onClick:d,className:"px-3 py-1.5 rounded-lg bg-indigo-500 text-white text-sm hover:bg-indigo-600 focus:outline-none focus:ring-2 focus:ring-indigo-400",children:"View / Buy"}),e.jsx("a",{href:s.url||"#",target:"_blank",rel:"noreferrer",className:"px-3 py-1.5 rounded-lg border border-gray-300 text-sm text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-300",children:"Preview"})]})]})]})}const re={apiKey:"AIzaSyCb5xW55HWh9op3BERJdFmvTyfgIoWbzEQ",authDomain:"picsellart-619a7.firebaseapp.com",projectId:"picsellart-619a7",storageBucket:"picsellart-619a7.firebasestorage.app",messagingSenderId:"347448234684",appId:"1:347448234684:web:24f131272d382cc9f1b6b9",measurementId:"G-3KNDHJ6JZY"},R=B().length?B()[0]:Q(re);X(R);new O;const ae=K(R),z=M(R),A=18,le="public";async function L(s={}){const{cursor:u=null,search:d="",storageCursor:l=null}=s;try{const a=V(ae,"publicImages"),x=u?_(a,F("createdAt","desc"),Y(u),G(A)):_(a,F("createdAt","desc"),G(A)),i=await ee(x);let h=i.docs.map(t=>{const o=t.data();return{id:t.id,title:o.title||t.id,tags:o.tags||[],publicPath:o.publicPath,createdAt:o.createdAt?.toMillis?.()??Date.now(),uid:o.uid||""}});const j=d.trim().toLowerCase();j&&(h=h.filter(t=>t.title?.toLowerCase().includes(j)||Array.isArray(t.tags)&&t.tags.join(" ").toLowerCase().includes(j)));const E=await Promise.all(h.map(async t=>{try{const o=await $(q(z,t.publicPath));return{...t,url:o}}catch{return{...t,url:null}}}));if(E.some(t=>!!t.url)){const t=i.docs.length?i.docs[i.docs.length-1]:null;return{source:"firestore",items:E.filter(o=>o.url),next:t||null,storageNext:l||null}}}catch{}const n=l?.prefix||le,I=l?.pageToken||void 0,N=q(z,n),p=await te(N,{maxResults:A,pageToken:I}),g=(await Promise.all(p.items.map(async a=>{try{const x=await $(a),h=((a.name||"").replace(/_wm\.jpg$/i,"")||"Photo").slice(0,40);return{id:a.fullPath,title:h,tags:[],publicPath:a.fullPath,createdAt:Date.now(),uid:"",url:x}}catch{return null}}))).filter(Boolean),m=d.trim().toLowerCase(),f=m?g.filter(a=>a.title.toLowerCase().includes(m)):g,v=p.nextPageToken?{prefix:n,pageToken:p.nextPageToken}:null;return{source:"storage",items:f,next:null,storageNext:v}}const ne=A;function ce(){const[s,u]=c.useState([]),[d,l]=c.useState(!0),[n,I]=c.useState(""),[N,p]=c.useState("firestore"),[C,g]=c.useState(""),m=c.useRef([]),f=c.useRef([]),[v,a]=c.useState(null),[x,i]=c.useState(null),h=c.useMemo(()=>n?`Explore: “${n}”`:"Explore Pictures",[n]);c.useEffect(()=>{let r=!0;async function y(){l(!0),g("");try{const{items:b,next:w,storageNext:P,source:S}=await L({cursor:v,search:n,storageCursor:x});if(!r)return;u(b),p(S||"firestore"),a(w||null),i(P||null)}catch{if(!r)return;g("Could not load images. Please try again."),u([])}finally{r&&l(!1)}}return y(),()=>{r=!1}},[n]);const j=async()=>{l(!0),g("");try{N==="firestore"?m.current.push(v):f.current.push(x);const{items:r,next:y,storageNext:b,source:w}=await L({cursor:v,search:n,storageCursor:x});u(r),p(w||"firestore"),a(y||null),i(b||null)}catch{g("Could not load next page.")}finally{l(!1)}},E=async()=>{if(N==="firestore"){const r=m.current.pop()||null;await t(n,m.current,null),a(r)}else{const r=f.current.pop()||null;await t(n,null,f.current),i(r)}},t=async(r,y,b)=>{l(!0),g("");try{let w=null,P=null,S=[];const U=(y?y.length:0)||(b?b.length:0);for(let D=0;D<=U;D++){const{items:J,next:W,storageNext:T,source:Z}=await L({cursor:w,search:r,storageCursor:P});if(S=J,w=W||null,P=T||null,Z==="storage"&&!T)break}u(S),p(y?"firestore":"storage"),a(w),i(P)}catch{g("Could not load previous page.")}finally{l(!1)}},o=!!v||!!x,k=m.current.length>0||f.current.length>0;return e.jsx("div",{className:"min-h-screen",children:e.jsxs("section",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-10",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-end sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl text-gray-900",children:h}),e.jsxs("p",{className:"text-gray-500 text-sm mt-1",children:["Showing up to ",ne," photos per page",N==="storage"?" (via Storage fallback)":"","."]})]}),e.jsx("div",{className:"w-full sm:w-80",children:e.jsx("input",{type:"search",value:n,onChange:r=>{m.current=[],f.current=[],a(null),i(null),I(r.target.value)},placeholder:"Search by title or tag…",className:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-400"})})]}),e.jsxs("div",{className:"mt-6",children:[d&&e.jsx("div",{className:"text-gray-500 text-sm",children:"Loading photos…"}),!d&&C&&e.jsx("div",{className:"text-red-600 text-sm",children:C}),!d&&!C&&s.length===0&&e.jsx("div",{className:"text-gray-500 text-sm",children:"No results."}),!d&&s.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4",children:s.map(r=>e.jsx(se,{photo:r},r.id))}),e.jsxs("div",{className:"flex items-center justify-between mt-8",children:[e.jsx("button",{type:"button",onClick:E,disabled:!k,className:`px-3 py-2 rounded-lg border text-sm ${k?"border-gray-300 text-gray-700 hover:bg-gray-50":"border-gray-200 text-gray-400 cursor-not-allowed"}`,children:"← Previous"}),e.jsx("button",{type:"button",onClick:j,disabled:!o,className:`px-3 py-2 rounded-lg text-sm ${o?"bg-indigo-500 text-white hover:bg-indigo-600":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:"Next →"})]})]})]})]})})}export{ce as default};
